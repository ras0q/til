(()=>{var Q=(e,r,t)=>(n,s)=>{let u=-1;return o(0);async function o(a){if(a<=u)throw new Error("next() called multiple times");u=a;let i,l=!1,c;if(e[a]?(c=e[a][0][0],n.req.routeIndex=a):c=a===e.length&&s||void 0,c)try{i=await c(n,()=>o(a+1))}catch(f){if(f instanceof Error&&r)n.error=f,i=await r(f,n),l=!0;else throw f}else n.finalized===!1&&t&&(i=await t(n));return i&&(n.finalized===!1||l)&&(n.res=i),n}};var xe=Symbol();var ke=async(e,r=Object.create(null))=>{let{all:t=!1,dot:n=!1}=r,u=(e instanceof F?e.raw.headers:e.headers).get("Content-Type");return u?.startsWith("multipart/form-data")||u?.startsWith("application/x-www-form-urlencoded")?Qe(e,{all:t,dot:n}):{}};async function Qe(e,r){let t=await e.formData();return t?Ye(t,r):{}}function Ye(e,r){let t=Object.create(null);return e.forEach((n,s)=>{r.all||s.endsWith("[]")?er(t,s,n):t[s]=n}),r.dot&&Object.entries(t).forEach(([n,s])=>{n.includes(".")&&(rr(t,n,s),delete t[n])}),t}var er=(e,r,t)=>{e[r]!==void 0?Array.isArray(e[r])?e[r].push(t):e[r]=[e[r],t]:r.endsWith("[]")?e[r]=[t]:e[r]=t},rr=(e,r,t)=>{let n=e,s=r.split(".");s.forEach((u,o)=>{o===s.length-1?n[u]=t:((!n[u]||typeof n[u]!="object"||Array.isArray(n[u])||n[u]instanceof File)&&(n[u]=Object.create(null)),n=n[u])})};var ee=e=>{let r=e.split("/");return r[0]===""&&r.shift(),r},Ee=e=>{let{groups:r,path:t}=tr(e),n=ee(t);return nr(n,r)},tr=e=>{let r=[];return e=e.replace(/\{[^}]+\}/g,(t,n)=>{let s=`@${n}`;return r.push([s,t]),s}),{groups:r,path:e}},nr=(e,r)=>{for(let t=r.length-1;t>=0;t--){let[n]=r[t];for(let s=e.length-1;s>=0;s--)if(e[s].includes(n)){e[s]=e[s].replace(n,r[t][1]);break}}return e},L={},we=(e,r)=>{if(e==="*")return"*";let t=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(t){let n=`${e}#${r}`;return L[n]||(t[2]?L[n]=r&&r[0]!==":"&&r[0]!=="*"?[n,t[1],new RegExp(`^${t[2]}(?=/${r})`)]:[e,t[1],new RegExp(`^${t[2]}$`)]:L[n]=[e,t[1],!0]),L[n]}return null},z=(e,r)=>{try{return r(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,t=>{try{return r(t)}catch{return t}})}},sr=e=>z(e,decodeURI),re=e=>{let r=e.url,t=r.indexOf("/",r.charCodeAt(9)===58?13:8),n=t;for(;n<r.length;n++){let s=r.charCodeAt(n);if(s===37){let u=r.indexOf("?",n),o=r.slice(t,u===-1?void 0:u);return sr(o.includes("%25")?o.replace(/%25/g,"%2525"):o)}else if(s===63)break}return r.slice(t,n)};var _e=e=>{let r=re(e);return r.length>1&&r.at(-1)==="/"?r.slice(0,-1):r},_=(e,r,...t)=>(t.length&&(r=_(r,...t)),`${e?.[0]==="/"?"":"/"}${e}${r==="/"?"":`${e?.at(-1)==="/"?"":"/"}${r?.[0]==="/"?r.slice(1):r}`}`),G=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;let r=e.split("/"),t=[],n="";return r.forEach(s=>{if(s!==""&&!/\:/.test(s))n+="/"+s;else if(/\:/.test(s))if(/\?/.test(s)){t.length===0&&n===""?t.push("/"):t.push(n);let u=s.replace("?","");n+="/"+u,t.push(n)}else n+="/"+s}),t.filter((s,u,o)=>o.indexOf(s)===u)},Y=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?z(e,te):e):e,Ae=(e,r,t)=>{let n;if(!t&&r&&!/[%+]/.test(r)){let o=e.indexOf(`?${r}`,8);for(o===-1&&(o=e.indexOf(`&${r}`,8));o!==-1;){let a=e.charCodeAt(o+r.length+1);if(a===61){let i=o+r.length+2,l=e.indexOf("&",i);return Y(e.slice(i,l===-1?void 0:l))}else if(a==38||isNaN(a))return"";o=e.indexOf(`&${r}`,o+1)}if(n=/[%+]/.test(e),!n)return}let s={};n??=/[%+]/.test(e);let u=e.indexOf("?",8);for(;u!==-1;){let o=e.indexOf("&",u+1),a=e.indexOf("=",u);a>o&&o!==-1&&(a=-1);let i=e.slice(u+1,a===-1?o===-1?void 0:o:a);if(n&&(i=Y(i)),u=o,i==="")continue;let l;a===-1?l="":(l=e.slice(a+1,o===-1?void 0:o),n&&(l=Y(l))),t?(s[i]&&Array.isArray(s[i])||(s[i]=[]),s[i].push(l)):s[i]??=l}return r?s[r]:s},$e=Ae,Pe=(e,r)=>Ae(e,r,!0),te=decodeURIComponent;var Re=e=>z(e,te),F=class{raw;#r;#e;routeIndex=0;path;bodyCache={};constructor(e,r="/",t=[[]]){this.raw=e,this.path=r,this.#e=t,this.#r={}}param(e){return e?this.#t(e):this.#i()}#t(e){let r=this.#e[0][this.routeIndex][1][e],t=this.#s(r);return t?/\%/.test(t)?Re(t):t:void 0}#i(){let e={},r=Object.keys(this.#e[0][this.routeIndex][1]);for(let t of r){let n=this.#s(this.#e[0][this.routeIndex][1][t]);n&&typeof n=="string"&&(e[t]=/\%/.test(n)?Re(n):n)}return e}#s(e){return this.#e[1]?this.#e[1][e]:e}query(e){return $e(this.url,e)}queries(e){return Pe(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;let r={};return this.raw.headers.forEach((t,n)=>{r[n]=t}),r}async parseBody(e){return this.bodyCache.parsedBody??=await ke(this,e)}#n=e=>{let{bodyCache:r,raw:t}=this,n=r[e];if(n)return n;let s=Object.keys(r)[0];return s?r[s].then(u=>(s==="json"&&(u=JSON.stringify(u)),new Response(u)[e]())):r[e]=t[e]()};json(){return this.#n("text").then(e=>JSON.parse(e))}text(){return this.#n("text")}arrayBuffer(){return this.#n("arrayBuffer")}blob(){return this.#n("blob")}formData(){return this.#n("formData")}addValidatedData(e,r){this.#r[e]=r}valid(e){return this.#r[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[xe](){return this.#e}get matchedRoutes(){return this.#e[0].map(([[,e]])=>e)}get routePath(){return this.#e[0].map(([[,e]])=>e)[this.routeIndex].path}};var Oe={Stringify:1,BeforeStream:2,Stream:3},ir=(e,r)=>{let t=new String(e);return t.isEscaped=!0,t.callbacks=r,t};var ne=async(e,r,t,n,s)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));let u=e.callbacks;if(!u?.length)return Promise.resolve(e);s?s[0]+=e:s=[e];let o=Promise.all(u.map(a=>a({phase:r,buffer:s,context:n}))).then(a=>Promise.all(a.filter(Boolean).map(i=>ne(i,r,!1,n,s))).then(()=>s[0]));return t?ir(await o,u):o};var ur="text/plain; charset=UTF-8",se=(e,r)=>({"Content-Type":e,...r}),je=class{#r;#e;env={};#t;finalized=!1;error;#i;#s;#n;#c;#a;#l;#o;#f;#p;constructor(e,r){this.#r=e,r&&(this.#s=r.executionCtx,this.env=r.env,this.#l=r.notFoundHandler,this.#p=r.path,this.#f=r.matchResult)}get req(){return this.#e??=new F(this.#r,this.#p,this.#f),this.#e}get event(){if(this.#s&&"respondWith"in this.#s)return this.#s;throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#s)return this.#s;throw Error("This context has no ExecutionContext")}get res(){return this.#n||=new Response(null,{headers:this.#o??=new Headers})}set res(e){if(this.#n&&e){e=new Response(e.body,e);for(let[r,t]of this.#n.headers.entries())if(r!=="content-type")if(r==="set-cookie"){let n=this.#n.headers.getSetCookie();e.headers.delete("set-cookie");for(let s of n)e.headers.append("set-cookie",s)}else e.headers.set(r,t)}this.#n=e,this.finalized=!0}render=(...e)=>(this.#a??=r=>this.html(r),this.#a(...e));setLayout=e=>this.#c=e;getLayout=()=>this.#c;setRenderer=e=>{this.#a=e};header=(e,r,t)=>{this.finalized&&(this.#n=new Response(this.#n.body,this.#n));let n=this.#n?this.#n.headers:this.#o??=new Headers;r===void 0?n.delete(e):t?.append?n.append(e,r):n.set(e,r)};status=e=>{this.#i=e};set=(e,r)=>{this.#t??=new Map,this.#t.set(e,r)};get=e=>this.#t?this.#t.get(e):void 0;get var(){return this.#t?Object.fromEntries(this.#t):{}}#u(e,r,t){let n=this.#n?new Headers(this.#n.headers):this.#o??new Headers;if(typeof r=="object"&&"headers"in r){let u=r.headers instanceof Headers?r.headers:new Headers(r.headers);for(let[o,a]of u)o.toLowerCase()==="set-cookie"?n.append(o,a):n.set(o,a)}if(t)for(let[u,o]of Object.entries(t))if(typeof o=="string")n.set(u,o);else{n.delete(u);for(let a of o)n.append(u,a)}let s=typeof r=="number"?r:r?.status??this.#i;return new Response(e,{status:s,headers:n})}newResponse=(...e)=>this.#u(...e);body=(e,r,t)=>this.#u(e,r,t);text=(e,r,t)=>!this.#o&&!this.#i&&!r&&!t&&!this.finalized?new Response(e):this.#u(e,r,se(ur,t));json=(e,r,t)=>this.#u(JSON.stringify(e),r,se("application/json",t));html=(e,r,t)=>{let n=s=>this.#u(s,r,se("text/html; charset=UTF-8",t));return typeof e=="object"?ne(e,Oe.Stringify,!1,{}).then(n):n(e)};redirect=(e,r)=>{let t=String(e);return this.header("Location",/[^\x00-\xFF]/.test(t)?encodeURI(t):t),this.newResponse(null,r??302)};notFound=()=>(this.#l??=()=>new Response,this.#l(this))};var p="ALL",De="all",Ie=["get","post","put","delete","options","patch"],B="Can not add a route since the matcher is already built.",U=class extends Error{};var Se="__COMPOSED_HANDLER";var or=e=>e.text("404 Not Found",404),qe=(e,r)=>{if("getResponse"in e){let t=e.getResponse();return r.newResponse(t.body,t)}return console.error(e),r.text("Internal Server Error",500)},ie=class{get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#r="/";routes=[];constructor(e={}){[...Ie,De].forEach(s=>{this[s]=(u,...o)=>(typeof u=="string"?this.#r=u:this.#i(s,this.#r,u),o.forEach(a=>{this.#i(s,this.#r,a)}),this)}),this.on=(s,u,...o)=>{for(let a of[u].flat()){this.#r=a;for(let i of[s].flat())o.map(l=>{this.#i(i.toUpperCase(),this.#r,l)})}return this},this.use=(s,...u)=>(typeof s=="string"?this.#r=s:(this.#r="*",u.unshift(s)),u.forEach(o=>{this.#i(p,this.#r,o)}),this);let{strict:t,...n}=e;Object.assign(this,n),this.getPath=t??!0?e.getPath??re:_e}#e(){let e=new ie({router:this.router,getPath:this.getPath});return e.errorHandler=this.errorHandler,e.#t=this.#t,e.routes=this.routes,e}#t=or;errorHandler=qe;route(e,r){let t=this.basePath(e);return r.routes.map(n=>{let s;r.errorHandler===qe?s=n.handler:(s=async(u,o)=>(await Q([],r.errorHandler)(u,()=>n.handler(u,o))).res,s[Se]=n.handler),t.#i(n.method,n.path,s)}),this}basePath(e){let r=this.#e();return r._basePath=_(this._basePath,e),r}onError=e=>(this.errorHandler=e,this);notFound=e=>(this.#t=e,this);mount(e,r,t){let n,s;t&&(typeof t=="function"?s=t:(s=t.optionHandler,t.replaceRequest===!1?n=a=>a:n=t.replaceRequest));let u=s?a=>{let i=s(a);return Array.isArray(i)?i:[i]}:a=>{let i;try{i=a.executionCtx}catch{}return[a.env,i]};n||=(()=>{let a=_(this._basePath,e),i=a==="/"?0:a.length;return l=>{let c=new URL(l.url);return c.pathname=c.pathname.slice(i)||"/",new Request(c,l)}})();let o=async(a,i)=>{let l=await r(n(a.req.raw),...u(a));if(l)return l;await i()};return this.#i(p,_(e,"*"),o),this}#i(e,r,t){e=e.toUpperCase(),r=_(this._basePath,r);let n={basePath:this._basePath,path:r,method:e,handler:t};this.router.add(e,r,[t,n]),this.routes.push(n)}#s(e,r){if(e instanceof Error)return this.errorHandler(e,r);throw e}#n(e,r,t,n){if(n==="HEAD")return(async()=>new Response(null,await this.#n(e,r,t,"GET")))();let s=this.getPath(e,{env:t}),u=this.router.match(n,s),o=new je(e,{path:s,matchResult:u,env:t,executionCtx:r,notFoundHandler:this.#t});if(u[0].length===1){let i;try{i=u[0][0][0][0](o,async()=>{o.res=await this.#t(o)})}catch(l){return this.#s(l,o)}return i instanceof Promise?i.then(l=>l||(o.finalized?o.res:this.#t(o))).catch(l=>this.#s(l,o)):i??this.#t(o)}let a=Q(u[0],this.errorHandler,this.#t);return(async()=>{try{let i=await a(o);if(!i.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return i.res}catch(i){return this.#s(i,o)}})()}fetch=(e,...r)=>this.#n(e,r[1],r[0],e.method);request=(e,r,t,n)=>e instanceof Request?this.fetch(r?new Request(e,r):e,t,n):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${_("/",e)}`,r),t,n));fire=()=>{addEventListener("fetch",e=>{e.respondWith(this.#n(e.request,e,void 0,e.request.method))})}};var X="[^/]+",S=".*",q="(?:|/.*)",A=Symbol(),ar=new Set(".\\+*[^]$()");function lr(e,r){return e.length===1?r.length===1?e<r?-1:1:-1:r.length===1||e===S||e===q?1:r===S||r===q?-1:e===X?1:r===X?-1:e.length===r.length?e<r?-1:1:r.length-e.length}var W=class{#r;#e;#t=Object.create(null);insert(e,r,t,n,s){if(e.length===0){if(this.#r!==void 0)throw A;if(s)return;this.#r=r;return}let[u,...o]=e,a=u==="*"?o.length===0?["","",S]:["","",X]:u==="/*"?["","",q]:u.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),i;if(a){let l=a[1],c=a[2]||X;if(l&&a[2]&&(c===".*"||(c=c.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(c))))throw A;if(i=this.#t[c],!i){if(Object.keys(this.#t).some(f=>f!==S&&f!==q))throw A;if(s)return;i=this.#t[c]=new W,l!==""&&(i.#e=n.varIndex++)}!s&&l!==""&&t.push([l,i.#e])}else if(i=this.#t[u],!i){if(Object.keys(this.#t).some(l=>l.length>1&&l!==S&&l!==q))throw A;if(s)return;i=this.#t[u]=new W}i.insert(o,r,t,n,s)}buildRegExpStr(){let r=Object.keys(this.#t).sort(lr).map(t=>{let n=this.#t[t];return(typeof n.#e=="number"?`(${t})@${n.#e}`:ar.has(t)?`\\${t}`:t)+n.buildRegExpStr()});return typeof this.#r=="number"&&r.unshift(`#${this.#r}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}};var Ce=class{#r={varIndex:0};#e=new W;insert(e,r,t){let n=[],s=[];for(let o=0;;){let a=!1;if(e=e.replace(/\{[^}]+\}/g,i=>{let l=`@\\${o}`;return s[o]=[l,i],o++,a=!0,l}),!a)break}let u=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let o=s.length-1;o>=0;o--){let[a]=s[o];for(let i=u.length-1;i>=0;i--)if(u[i].indexOf(a)!==-1){u[i]=u[i].replace(a,s[o][1]);break}}return this.#e.insert(u,r,n,this.#r,t),n}buildRegExp(){let e=this.#e.buildRegExpStr();if(e==="")return[/^$/,[],[]];let r=0,t=[],n=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(s,u,o)=>u!==void 0?(t[++r]=Number(u),"$()"):(o!==void 0&&(n[Number(o)]=++r),"")),[new RegExp(`^${e}`),t,n]}};var Me=[],cr=[/^$/,[],Object.create(null)],Te=Object.create(null);function Ne(e){return Te[e]??=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(r,t)=>t?`\\${t}`:"(?:|/.*)")}$`)}function fr(){Te=Object.create(null)}function pr(e){let r=new Ce,t=[];if(e.length===0)return cr;let n=e.map(l=>[!/\*|\/:/.test(l[0]),...l]).sort(([l,c],[f,m])=>l?1:f?-1:c.length-m.length),s=Object.create(null);for(let l=0,c=-1,f=n.length;l<f;l++){let[m,d,h]=n[l];m?s[d]=[h.map(([g])=>[g,Object.create(null)]),Me]:c++;let v;try{v=r.insert(d,c,m)}catch(g){throw g===A?new U(d):g}m||(t[c]=h.map(([g,$])=>{let D=Object.create(null);for($-=1;$>=0;$--){let[b,Z]=v[$];D[b]=Z}return[g,D]}))}let[u,o,a]=r.buildRegExp();for(let l=0,c=t.length;l<c;l++)for(let f=0,m=t[l].length;f<m;f++){let d=t[l][f]?.[1];if(!d)continue;let h=Object.keys(d);for(let v=0,g=h.length;v<g;v++)d[h[v]]=a[d[h[v]]]}let i=[];for(let l in o)i[l]=t[o[l]];return[u,i,s]}function P(e,r){if(e){for(let t of Object.keys(e).sort((n,s)=>s.length-n.length))if(Ne(t).test(r))return[...e[t]]}}var ue=class{name="RegExpRouter";#r;#e;constructor(){this.#r={[p]:Object.create(null)},this.#e={[p]:Object.create(null)}}add(e,r,t){let n=this.#r,s=this.#e;if(!n||!s)throw new Error(B);n[e]||[n,s].forEach(a=>{a[e]=Object.create(null),Object.keys(a[p]).forEach(i=>{a[e][i]=[...a[p][i]]})}),r==="/*"&&(r="*");let u=(r.match(/\/:/g)||[]).length;if(/\*$/.test(r)){let a=Ne(r);e===p?Object.keys(n).forEach(i=>{n[i][r]||=P(n[i],r)||P(n[p],r)||[]}):n[e][r]||=P(n[e],r)||P(n[p],r)||[],Object.keys(n).forEach(i=>{(e===p||e===i)&&Object.keys(n[i]).forEach(l=>{a.test(l)&&n[i][l].push([t,u])})}),Object.keys(s).forEach(i=>{(e===p||e===i)&&Object.keys(s[i]).forEach(l=>a.test(l)&&s[i][l].push([t,u]))});return}let o=G(r)||[r];for(let a=0,i=o.length;a<i;a++){let l=o[a];Object.keys(s).forEach(c=>{(e===p||e===c)&&(s[c][l]||=[...P(n[c],l)||P(n[p],l)||[]],s[c][l].push([t,u-i+a+1]))})}}match(e,r){fr();let t=this.#t();return this.match=(n,s)=>{let u=t[n]||t[p],o=u[2][s];if(o)return o;let a=s.match(u[0]);if(!a)return[[],Me];let i=a.indexOf("",1);return[u[1][i],a]},this.match(e,r)}#t(){let e=Object.create(null);return Object.keys(this.#e).concat(Object.keys(this.#r)).forEach(r=>{e[r]||=this.#i(r)}),this.#r=this.#e=void 0,e}#i(e){let r=[],t=e===p;return[this.#r,this.#e].forEach(n=>{let s=n[e]?Object.keys(n[e]).map(u=>[u,n[e][u]]):[];s.length!==0?(t||=!0,r.push(...s)):e!==p&&r.push(...Object.keys(n[p]).map(u=>[u,n[p][u]]))}),t?pr(r):null}};var oe=class{name="SmartRouter";#r=[];#e=[];constructor(e){this.#r=e.routers}add(e,r,t){if(!this.#e)throw new Error(B);this.#e.push([e,r,t])}match(e,r){if(!this.#e)throw new Error("Fatal error");let t=this.#r,n=this.#e,s=t.length,u=0,o;for(;u<s;u++){let a=t[u];try{for(let i=0,l=n.length;i<l;i++)a.add(...n[i]);o=a.match(e,r)}catch(i){if(i instanceof U)continue;throw i}this.match=a.match.bind(a),this.#r=[a],this.#e=void 0;break}if(u===s)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,o}get activeRouter(){if(this.#e||this.#r.length!==1)throw new Error("No active router has been determined yet.");return this.#r[0]}};var C=Object.create(null),ae=class{#r;#e;#t;#i=0;#s=C;constructor(e,r,t){if(this.#e=t||Object.create(null),this.#r=[],e&&r){let n=Object.create(null);n[e]={handler:r,possibleKeys:[],score:0},this.#r=[n]}this.#t=[]}insert(e,r,t){this.#i=++this.#i;let n=this,s=Ee(r),u=[];for(let o=0,a=s.length;o<a;o++){let i=s[o],l=s[o+1],c=we(i,l),f=Array.isArray(c)?c[0]:i;if(f in n.#e){n=n.#e[f],c&&u.push(c[1]);continue}n.#e[f]=new ae,c&&(n.#t.push(c),u.push(c[1])),n=n.#e[f]}return n.#r.push({[e]:{handler:t,possibleKeys:u.filter((o,a,i)=>i.indexOf(o)===a),score:this.#i}}),n}#n(e,r,t,n){let s=[];for(let u=0,o=e.#r.length;u<o;u++){let a=e.#r[u],i=a[r]||a[p],l={};if(i!==void 0&&(i.params=Object.create(null),s.push(i),t!==C||n&&n!==C))for(let c=0,f=i.possibleKeys.length;c<f;c++){let m=i.possibleKeys[c],d=l[i.score];i.params[m]=n?.[m]&&!d?n[m]:t[m]??n?.[m],l[i.score]=!0}}return s}search(e,r){let t=[];this.#s=C;let s=[this],u=ee(r),o=[];for(let a=0,i=u.length;a<i;a++){let l=u[a],c=a===i-1,f=[];for(let m=0,d=s.length;m<d;m++){let h=s[m],v=h.#e[l];v&&(v.#s=h.#s,c?(v.#e["*"]&&t.push(...this.#n(v.#e["*"],e,h.#s)),t.push(...this.#n(v,e,h.#s))):f.push(v));for(let g=0,$=h.#t.length;g<$;g++){let D=h.#t[g],b=h.#s===C?{}:{...h.#s};if(D==="*"){let k=h.#e["*"];k&&(t.push(...this.#n(k,e,h.#s)),k.#s=b,f.push(k));continue}let[Z,be,I]=D;if(!l&&!(I instanceof RegExp))continue;let x=h.#e[Z],Ke=u.slice(a).join("/");if(I instanceof RegExp){let k=I.exec(Ke);if(k){if(b[be]=k[0],t.push(...this.#n(x,e,h.#s,b)),Object.keys(x.#e).length){x.#s=b;let Ze=k[0].match(/\//)?.length??0;(o[Ze]||=[]).push(x)}continue}}(I===!0||I.test(l))&&(b[be]=l,c?(t.push(...this.#n(x,e,b,h.#s)),x.#e["*"]&&t.push(...this.#n(x.#e["*"],e,b,h.#s))):(x.#s=b,f.push(x)))}}s=f.concat(o.shift()??[])}return t.length>1&&t.sort((a,i)=>a.score-i.score),[t.map(({handler:a,params:i})=>[a,i])]}};var le=class{name="TrieRouter";#r;constructor(){this.#r=new ae}add(e,r,t){let n=G(r);if(n){for(let s=0,u=n.length;s<u;s++)this.#r.insert(e,n[s],t);return}this.#r.insert(e,r,t)}match(e,r){return this.#r.search(e,r)}};var ce=class extends ie{constructor(e={}){super(e),this.router=e.router??new oe({routers:[new ue,new le]})}};function J(){return{_features:[]}}function R(e,r={}){let{collectErrorMode:t="firstError",name:n}=r;return{config:{collectErrorMode:t,name:n},value:e,errors:[],isValue:s=>!0,hasError(){return this.errors.length>0},registerError(s){this.errors.push(s)}}}var hr=Object.defineProperty,yr=(e,r,t)=>r in e?hr(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,He=(e,r,t)=>yr(e,typeof r!="symbol"?r+"":r,t),mr=class fe{constructor(r){He(this,"id"),this.id=r}static get ZERO(){return this.nextIdValue=0,new fe(0)}static nextId(){return++this.nextIdValue}static nextCId(){return new fe(this.nextIdValue++)}toNumber(){return this.id}};He(mr,"nextIdValue",0);function M(e){if(typeof e!="object"||e===null)return e;if(Array.isArray(e))return e.map(t=>M(t));let r={};for(let t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=M(e[t]));return r}var Ve="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",E=`(${Ve}[.]){3}${Ve}`,$n=new RegExp(`^${E}$`),y="(?:[0-9a-fA-F]{1,4})",Pn=new RegExp(`^((?:${y}:){7}(?:${y}|:)|(?:${y}:){6}(?:${E}|:${y}|:)|(?:${y}:){5}(?::${E}|(:${y}){1,2}|:)|(?:${y}:){4}(?:(:${y}){0,1}:${E}|(:${y}){1,3}|:)|(?:${y}:){3}(?:(:${y}){0,2}:${E}|(:${y}){1,4}|:)|(?:${y}:){2}(?:(:${y}){0,3}:${E}|(:${y}){1,5}|:)|(?:${y}:){1}(?:(:${y}){0,4}:${E}|(:${y}){1,6}|:)|(?::((?::${y}){0,5}:${E}|(?::${y}){1,7}|:)))(%[0-9a-zA-Z-.:]{1,})?$`);var Le=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],Er=new Array(256).fill("");for(let e=0;e<256;e++)Er[e]=`${Le[e>>>4&15]}${Le[e&15]}`;var Ar=(e,r,t)=>new Promise((n,s)=>{var u=i=>{try{a(t.next(i))}catch(l){s(l)}},o=i=>{try{a(t.throw(i))}catch(l){s(l)}},a=i=>i.done?n(i.value):Promise.resolve(i.value).then(u,o);a((t=t.apply(e,r)).next())});function K(e){return{_validationChain:e,validate(r){return Ar(this,null,function*(){for(let t of this._validationChain)if(yield t.validate(r),r.config.collectErrorMode==="firstError"&&r.hasError())break})},push(r){this._validationChain.push(r)},append(r){return this._validationChain.push(...r._validationChain),this},clone(){return K(M(this._validationChain))}}}var $r=Object.defineProperty,Pr=(e,r,t)=>r in e?$r(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,O=(e,r,t)=>Pr(e,typeof r!="symbol"?r+"":r,t),T=class extends Error{constructor(r,t,n={}){var s;let{additionalErrors:u=[],description:o=(s=n.throwable)==null?void 0:s.message,throwable:a,uri:i}=n;super(o!=null?`[${r}] ${o}`:r),O(this,"code"),O(this,"throwable"),O(this,"status"),O(this,"description"),O(this,"uri"),O(this,"additionalErrors",[]),this.code=r,this.throwable=a,this.status=t,this.description=o,this.uri=i,this.additionalErrors=u,Error.captureStackTrace(this)}};var j=class extends T{constructor(r){super("#ERR_BAD_REQUEST",400,{description:"One or more validation errors occurred!",additionalErrors:r})}};function w(e){return e.replace(/\{(\w+)\}/g,":$1")}function N(e,r){let t={};for(let[n,s]of Object.entries(e))t[n]=r!=null&&r.includes(n)?s:ye(s);return t}function ye(e){return typeof e=="string"?Rr(e):Array.isArray(e)?jr(e):typeof e=="object"&&e!=null?Or(e):e}function Rr(e){if(e==="")return"";if(e==="null")return null;if(e==="undefined")return;if(e==="true")return!0;if(e==="false")return!1;let r=Number(e);return isNaN(r)?e:r}function Or(e){let r={};for(let[t,n]of Object.entries(e))r[t]=ye(n);return r}function jr(e){return e.map(ye)}var Ge=(e,r,t)=>new Promise((n,s)=>{var u=i=>{try{a(t.next(i))}catch(l){s(l)}},o=i=>{try{a(t.throw(i))}catch(l){s(l)}},a=i=>i.done?n(i.value):Promise.resolve(i.value).then(u,o);a((t=t.apply(e,r)).next())});function me(e,r){let t=Object.assign(e,{_hono:r,get(n,s){var u;this._hono.get(w(n),H(s),V(s),...(u=s.middlewares)!=null?u:[],s.handler)},post(n,s){var u;this._hono.post(w(n),H(s),V(s),...(u=s.middlewares)!=null?u:[],s.handler)},put(n,s){var u;this._hono.put(w(n),H(s),V(s),...(u=s.middlewares)!=null?u:[],s.handler)},del(n,s){var u;this._hono.delete(w(n),H(s),V(s),...(u=s.middlewares)!=null?u:[],s.handler)},patch(n,s){var u;this._hono.patch(w(n),H(s),V(s),...(u=s.middlewares)!=null?u:[],s.handler)}});return t._features.push("hono"),t}function H(e={}){let{parseParams:r=!0,parsePathParams:t=N,parsePathParamsBlacklist:n,parseQueryParams:s=N,parseQueryParamsBlacklist:u}=e;return(o,a)=>Ge(null,null,function*(){o.req.addValidatedData("query",r?s(o.req.query(),u):o.req.query()),o.req.addValidatedData("param",r?t(o.req.param(),n):o.req.param()),yield a()})}function V(e){let{bodyValidator:r,pathValidator:t,queryValidator:n}=e;return(s,u)=>Ge(null,null,function*(){var o,a;let i=[];if(r!=null){let l=yield s.req.json(),c=R(l);yield r.validate(c);for(let f of c.errors)f.source="body",i.push(f);c.errors.length<=0&&s.req.addValidatedData("json",l)}if(t!=null){let l=(o=s.req.valid("param"))!=null?o:s.req.param(),c=R(l);yield t.validate(c);for(let f of c.errors)f.source="path",i.push(f);c.errors.length<=0&&s.req.addValidatedData("param",l)}if(n!=null){let l=(a=s.req.valid("query"))!=null?a:s.req.query(),c=R(l);yield n.validate(c);for(let f of c.errors)f.source="query",i.push(f);c.errors.length<=0&&s.req.addValidatedData("query",l)}if(i.length>0)throw new j(i);yield u()})}function ve(e){return me(J(),e)}var de;function Ue(e){return{lang:e?.lang??de?.lang,message:e?.message,abortEarly:e?.abortEarly??de?.abortEarly,abortPipeEarly:e?.abortPipeEarly??de?.abortPipeEarly}}var Ir;function Sr(e){return Ir?.get(e)}var qr;function Cr(e){return qr?.get(e)}var Mr;function Tr(e,r){return Mr?.get(e)?.get(r)}function Nr(e){let r=typeof e;return r==="string"?`"${e}"`:r==="number"||r==="bigint"||r==="boolean"?`${e}`:r==="object"||r==="function"?(e&&Object.getPrototypeOf(e)?.constructor?.name)??"null":r}function Be(e,r,t,n,s){let u=s&&"input"in s?s.input:t.value,o=s?.expected??e.expects??null,a=s?.received??Nr(u),i={kind:e.kind,type:e.type,input:u,expected:o,received:a,message:`Invalid ${r}: ${o?`Expected ${o} but r`:"R"}eceived ${a}`,requirement:e.requirement,path:s?.path,issues:s?.issues,lang:n.lang,abortEarly:n.abortEarly,abortPipeEarly:n.abortPipeEarly},l=e.kind==="schema",c=s?.message??e.message??Tr(e.reference,i.lang)??(l?Cr(i.lang):null)??n.message??Sr(i.lang);c!==void 0&&(i.message=typeof c=="function"?c(i):c),l&&(t.typed=!1),t.issues?t.issues.push(i):t.issues=[i]}function Hr(e){return{version:1,vendor:"valibot",validate(r){return e["~run"]({value:r},Ue())}}}function Xe(e){if(e.path){let r="";for(let t of e.path)if(typeof t.key=="string"||typeof t.key=="number")r?r+=`.${t.key}`:r+=t.key;else return null;return r}return null}function Vr(e,r,t){return typeof e.fallback=="function"?e.fallback(r,t):e.fallback}function Fr(e,r,t){return typeof e.default=="function"?e.default(r,t):e.default}function ge(e,r){return{kind:"schema",type:"object",reference:ge,expects:"Object",async:!1,entries:e,message:r,get"~standard"(){return Hr(this)},"~run"(t,n){let s=t.value;if(s&&typeof s=="object"){t.typed=!0,t.value={};for(let u in this.entries){let o=this.entries[u];if(u in s||(o.type==="exact_optional"||o.type==="optional"||o.type==="nullish")&&o.default!==void 0){let a=u in s?s[u]:Fr(o),i=o["~run"]({value:a},n);if(i.issues){let l={type:"object",origin:"value",input:s,key:u,value:a};for(let c of i.issues)c.path?c.path.unshift(l):c.path=[l],t.issues?.push(c);if(t.issues||(t.issues=i.issues),n.abortEarly){t.typed=!1;break}}i.typed||(t.typed=!1),t.value[u]=i.value}else if(o.fallback!==void 0)t.value[u]=Vr(o);else if(o.type!=="exact_optional"&&o.type!=="optional"&&o.type!=="nullish"&&(Be(this,"key",t,n,{input:void 0,expected:`"${u}"`,path:[{type:"object",origin:"key",input:s,key:u,value:s[u]}]}),n.abortEarly))break}}else Be(this,"type",t,n);return t}}}function We(e,r,t){let n=e["~run"]({value:r},Ue(t));return{typed:n.typed,success:!n.issues,output:n.value,issues:n.issues}}var zr=(e,r,t)=>new Promise((n,s)=>{var u=i=>{try{a(t.next(i))}catch(l){s(l)}},o=i=>{try{a(t.throw(i))}catch(l){s(l)}},a=i=>i.done?n(i.value):Promise.resolve(i.value).then(u,o);a((t=t.apply(e,r)).next())});function Je(e){return K([{key:"valibot",validate:r=>zr(null,null,function*(){var t;let n=We(e,r.value,{abortPipeEarly:r.config.collectErrorMode==="firstError"});if(n.issues!=null)for(let s of n.issues)r.registerError({code:s.type,message:s.message,path:(t=Xe(s))!=null?t:void 0})})}])}var Gr=new ce,Br=ve(Gr);Br.get("/chat/completions",{queryValidator:Je(ge({})),handler:e=>{let r=e.req.valid("query");return console.log("query",r),e.json({object:"list",data:[{id:"string",choices:[{finish_reason:"stop",index:0,message:{content:"string",refusal:"string",tool_calls:[{id:"string",type:"function",function:{name:"string",arguments:"string"}},{id:"string",type:"custom",custom:{name:"string",input:"string"}}],annotations:[{type:"url_citation",url_citation:{end_index:0,start_index:0,url:"string",title:"string"}}],role:"assistant",audio:{id:"string",expires_at:0,data:"string",transcript:"string"}},logprobs:{content:[{token:"string",logprob:0,bytes:[0],top_logprobs:[{token:"string",logprob:0,bytes:[0]}]}],refusal:[{token:"string",logprob:0,bytes:[0],top_logprobs:[{token:"string",logprob:0,bytes:[0]}]}]}}],created:0,model:"string",service_tier:"auto",object:"chat.completion",usage:{completion_tokens:0,prompt_tokens:0,total_tokens:0,completion_tokens_details:{accepted_prediction_tokens:0,audio_tokens:0,reasoning_tokens:0,rejected_prediction_tokens:0},prompt_tokens_details:{audio_tokens:0,cached_tokens:0}}}],first_id:"string",last_id:"string",has_more:!0})}});})();
